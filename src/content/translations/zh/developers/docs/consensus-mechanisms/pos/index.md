---
title: 权益证明机制(PoS)
description: 权益证明共识算法以及其在以太坊中作用的解释。
lang: zh
---

权益证明 (PoS) 是[合并](/upgrades/merge)之后以太坊将使用的[共识机制](/developers/docs/consensus-mechanisms/)。 以太坊正在从[工作量证明 (PoW) ](/developers/docs/consensus-mechanisms/pow/)过渡到权益证明，因为权益证明更安全、能耗更低并且更适合实现新扩容解决方案。 虽然以太坊一直计划着向权益证明过渡，但是权益证明比工作量证明更复杂，并且完善这一机制已经耗费多年的研发时间。 当前的挑战是在以太坊主网上实现权益证明。 该过程称为[“合并”](/upgrades/merge/)。

## 前提条件 {#prerequisites}

为了更好地理解本文，我们建议你首先阅读以下内容 [共识机制](/developers/docs/consensus-mechanisms/)。

## 什么是权益证明？ {#what-is-pos}

权益证明是区块链用来达成分步式共识的一种[共识机制](/developers/docs/consensus-mechanisms/)。 在工作量证明共识机制中，矿工通过消耗能源来证明他们拥有资本以应对风险。 而在权益证明共识机制中，验证者明确地通过以太币将资本质押到以太坊上的智能合约中。 质押的以太币随后将作为抵押品，如果验证者表现出不诚实或懒惰，就可以销毁这些以太币。 之后，验证者负责检查在网络上传播的新区块是否有效，并偶尔自己也创建和传播新区块。

与工作量证明体系相比，权益证明有许多改进：

- 能效更高 – 无需在工作量证明计算中使用大量能源
- 门槛更低、硬件要求下降 – 无需购买高性能硬件以便获得创建新区块的机会
- 中心化风险降低 – 权益证明应该可以增加保护网络安全的节点
- 由于能源需求低，发行较少的以太币就可以激励大家参与
- 与工作量证明相比，对不当行为的经济处罚让 51% 攻击的代价呈指数级增加。
- 如果 51% 攻击是为了攻破加密经济的防御，那么社区可以求助于诚实链的社会恢复。

## 验证者 {#validators}

要想作为验证者参与，用户必须向存款合约存入 32 个以太币并运行三种独立的软件：执行客户端、共识客户端和验证者。 存入以太币时，用户会加入一个激活队列，对新验证者加入网络的速度进行限制。 激活后，验证者将从以太坊网络上的对等节点接收新区块。 区块中交付的交易会被重新执行，并且对区块签名进行检查以确保区块是有效的。 然后验证者在整个网络上发送支持该区块的投票（称为认证）。

在工作量证明中，生成区块的时间是由挖矿难度决定的，而在权益证明中，节奏是固定的。 权益证明以太坊中的时间分为时隙（12 秒）和时段（32 个时隙）。 在每个时隙中随机选择一位验证者作为区块提议者。 该验证者负责创建新区块并发送给网络上的其他节点。 另外在每个时隙中，都会随机选择一个验证者委员会，通过他们的投票确定所提议区块的有效性。

## 最终确定性 {#finality}

一个交易在分布式网络具有“最终确定性”是指，该交易是区块的一部分且无法改变，除非燃烧掉大量以太币。 在权益证明以太坊上，通过“检查点”区块来管理确定性。 每个时段中的第一个区块是检查点。 验证者为他们认为有效的“检查点对”投票。 如果一对检查点获得至少达到质押以太币总数三分之二的投票，那么这两个检查点会升级。 这两个检查点中较新的一个会变成“合理”状态。 较旧的一个检查点已经是合理状态，因为它是上一个时段中的“目标”。 现在，这个检查点会升级为“已确定”状态。 要回滚已确定区块，攻击者将承担至少相当于质押以太币总数（目前约价值 $10,000,000,000）三分之一的损失。 确切解释可参阅[这篇以太坊基金会博文](https://blog.ethereum.org/2016/05/09/on-settlement-finality/)。 因为最终确定性需要获得三分之二多数投票，攻击者可以用质押以太币总数的三分之一投票来阻止网络实现最终确定性。 有一种可以防御这种攻击行为的机制：[怠惰惩罚](https://arxiv.org/pdf/2003.03052.pdf)。 当链超过四个时段无法最终确定时，这项机制会触发。 怠惰惩罚逐渐消耗与大多数投票相反的验证者的质押以太币，使得大多数验证者重新获得三分之二多数投票并最终确定链。

## 加密经济的安全性 {#crypto-economic-security}

运行验证者是一种承诺。 验证者应当保持足够的硬件和连接，来参与区块的验证和提出。 作为回报，验证者将获得以太币（他们的质押余额增加）。 另一方面，作为验证者参与，也为用户为了个人利益或破坏而攻击网络开辟了新的渠道。 为了防止这种情况，如果在要求参与时没有参与，验证者会错过以太币奖励，而且如果验证者有不诚实的行为，他们现有的质押以太币会被销毁。 主要有两种行为被视为不诚实：在一个时隙中提出多个区块（模棱两可）和提交相互矛盾的认证。 被罚没以太币的金额取决于大致同一时间受到罚没的验证者数量。 这称为[“相关惩罚”](https://arxiv.org/pdf/2003.03052.pdf)，相关惩罚可以是轻微的（单个验证者被罚没质押以太币的 1%），也可以导致验证者质押的以太币全部被销毁（大额罚没事件）。 这种惩罚在强制退出期执行，首先是第 1 天的立即处罚（最多 0.5 个以太币），接着是第 18 天的相关惩罚，最后是第 36 天的逐出网络。 如果验证者在网络上但不提交投票，他们每天都会受到轻微的认证惩罚。 对于攻击者来说，这些措施都意味着协同攻击的代价将极其高昂。

## 分叉选择 {#fork-choice}

当网络以最佳状态诚信运行时，链头始终只会有一个新区块并且所有验证者都会证明它。 然而，由于网络延迟或因为区块提议者提议多个区块（模棱两可），验证者可能看到不同的链头视图。 因此，共识客户端需要一种算法来确定支持哪一个区块。 权益证明以太坊中使用的算法称为 [LMD-GHOST](https://arxiv.org/pdf/2003.03052.pdf)。它的工作原理是确定其历史记录中具有最大证明权重的分叉。

## 权益证明和安全性 {#pos-and-security}

### 验证是如何工作的？ {#how-does-validation-work}

51% 攻击只是其中一种恶意行为。 不良行为者可能会尝试远程攻击（尽管最终确定性小工具抵消了这种攻击向量）、短程“重组”（尽管提议者权重提升和认证期限可以缓解这种情况)、弹跳攻击和平衡攻击（也可以通过提议者权重提升来缓解，并且这些攻击只能在理想化的网络条件下演示）或雪崩攻击（被只考虑最新消息的分叉选择算法规则抵消）。

总的来说，已经证实以太坊实施的权益证明在经济方面比工作量证明更安全。

## 优点和缺点 {#pros-and-cons}

| 优点                                                                                                                                           | 缺点                                                               |
| ---------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ |
| 质押使个人更容易参与其中保障网络的安全，促进去中心化。 验证者节点可以在普通笔记本电脑上运行。 质押池让用户可以在没有 32 个以太币的情况下质押。 | 与工作量证明相比，权益证明仍处于起步阶段，并且经过的实践检验较少。 |
| 权益质押更加去中心化。 规模经济不像适用于工作量证明挖矿那样适用于权益证明。                                                                    | 实现权益证明比实现工作量证明更加复杂。                             |
| 权益证明的加密经济安全性高于工作量证明                                                                                                         | 用户需要运行三种软件才能参与以太坊的权益证明。                     |
| 需要发行较少的新以太币就可以激励网络参与者                                                                                                     |                                                                    |

## 延伸阅读 {#further-reading}

- [Proof of Stake FAQ](https://vitalik.ca/general/2017/12/31/pos_faq.html) _Vitalik Buterin_
- [What is Proof of Stake](https://consensys.net/blog/blockchain-explained/what-is-proof-of-stake/) _ConsenSys_
- [What Proof of Stake Is And Why It Matters](https://bitcoinmagazine.com/culture/what-proof-of-stake-is-and-why-it-matters-1377531463) _Vitalik Buterin_
- [The Beacon Chain Ethereum 2.0 explainer you need to read first](https://ethos.dev/beacon-chain/) _Ethos.dev_
- [Why Proof of Stake (Nov 2020)](https://vitalik.ca/general/2020/11/06/pos2020.html) _Vitalik Buterin_
- [Proof of Stake: How I Learned to Love Weak Subjectivity](https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/) _Vitalik Buterin_
- [A Proof of Stake Design Philosophy](https://medium.com/@VitalikButerin/a-proof-of-stake-design-philosophy-506585978d51) _Vitalik Buterin_

## 相关主题 {#related-topics}

- [工作量证明](/developers/docs/consensus-mechanisms/pow/)
